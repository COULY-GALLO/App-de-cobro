<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Cobro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- SDK MercadoPago.js -->
    <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>
<body>
    <div class="container">
        <h1 class="my-4">Simulador de Cobro</h1>
        <ul class="list-group">
            {% for order in orders %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                Pedido #{{ order.id }} - Total: {{ order.total }}
                <div id="wallet_container_{{ order.id }}" 
                     data-preference-id="{{ order.preference_id }}">
                </div>
                <!-- Botón de pago -->
            </li>
            {% endfor %}
        </ul>
    </div>
    <script>
        // Inicializa el SDK de Mercado Pago
        const mp = new MercadoPago("TEST-3727573019792359-082715-20105548c6dd3fd578d57c7c80bca7d8-1194947549"); // Reemplaza 'YOUR_PUBLIC_KEY' con tu clave pública

        // Espera a que el DOM esté completamente cargado
        document.addEventListener("DOMContentLoaded", function() {
            // Selecciona todos los elementos que tienen un contenedor para el botón de pago
            document.querySelectorAll('[id^="wallet_container_"]').forEach(container => {
                // Obtén el ID de preferencia del atributo data
                const preferenceId = container.getAttribute('data-preference-id');
                
                // Crea una instancia del componente de pago
                mp.bricks().create("wallet", container.id, {
                    initialization: {
                        preferenceId: preferenceId
                    },
                    customization: {
                        texts: {
                            valueProp: 'Pagar ahora'
                        }
                    }
                });
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
